version="$BASH_VERSION"
a=( ${version//./ } )                   # replace points, split into array
version="${a[0]}"
if ((version < 4 )); then
    echo "ALERT: nix support for direnv requires bash version 4 or higher to work. Please upgrade bash to be able to load nix and nix-devenv from direnv."
    exit 1
fi

if ! has nix_direnv_version || ! nix_direnv_version 2.1.1; then
  source_url "https://raw.githubusercontent.com/nix-community/nix-direnv/2.1.1/direnvrc" "sha256-b6qJ4r34rbE23yWjMqbmu3ia2z4b2wIlZUksBke/ol0="
fi

export WORKSPACE="${PWD}"
export PACK_DIR="${PWD}/.pack"

# Loads a “.env.local” file into the current environment, but only if it exists
dotenv_if_exists .env.local

nix_direnv_watch_file ./flake.nix
nix_direnv_watch_file ./shell.nix
nix_direnv_watch_file ./nix/*
nix_direnv_watch_file ./nix/**/*

use flake

